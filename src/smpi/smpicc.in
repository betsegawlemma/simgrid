#! /bin/bash
#FIXME: .. paths...
prefix="@prefix@"
exec_prefix="@exec_prefix@"

CC="gcc"
CFLAGS="-O2 -Dmain=smpi_simulated_main"

#FIXME: probably only want the last two pairs after 'make install'
INCLUDEARGS="-I@top_srcdir@/include -I@top_srcdir@/include/smpi -I@includedir@ -I@includedir@/smpi"
CMAKE_LINKARGS="-L@CMAKE_LINKARGS@"
LINKARGS="-L@top_builddir@/src/.libs -L@libdir@ -lsimgrid -lsmpi "

CMDLINE=""
while [ -n "$1" ]; do
  ARG="$1"
  shift
  if [ "${ARG}" = "-c" ]; then
      LINKARGS=""
      CMDLINE="${CMDLINE} -c "
  elif [ "${ARG%.c}" != "${ARG}" ]; then
    SRCFILE="$(readlink -f ${ARG} 2>/dev/null)"
    if [ -z $SRCFILE ] ; then
      SRCFILE="$ARG"
    fi
    CMDLINE="${CMDLINE} ${SRCFILE} "
  else
    CMDLINE="${CMDLINE} ${ARG} "
  fi
done

CMDLINE="${CC} ${INCLUDEARGS} ${CFLAGS} ${CMDLINE} ${CMAKE_LINKARGS} ${LINKARGS}"

#echo "${CMDLINE}"
${CMDLINE}
